<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Ludo Lobby</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 40px;
    }
    .players {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 30px;
    }
    .player {
      padding: 20px;
      border: 2px solid #333;
      border-radius: 10px;
      width: 100px;
      cursor: pointer;
    }
    .taken {
      background-color: #ccc;
      cursor: not-allowed;
      color: #888;
    }
    .chosen {
      background-color: #4caf50;
      color: white;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Ludo Game Lobby</h1>
  <div class="players">
    <div class="player" data-num="1">Player 1</div>
    <div class="player" data-num="2">Player 2</div>
    <div class="player" data-num="3">Player 3</div>
    <div class="player" data-num="4">Player 4</div>
  </div>
  <p id="status">Select a player slot</p>

  <script>
    const status = document.getElementById('status');
    const ws = new WebSocket(`ws://${location.host}`);
    let chosenPlayer = null;

    ws.onmessage = (event) => {
      const msg = JSON.parse(event.data);

      if (msg.type === 'state') {
        document.querySelectorAll('.player').forEach(el => {
          const num = el.dataset.num;
          el.classList.remove('taken', 'chosen');
          if (msg.takenPlayers[num]) {
            el.classList.add('taken');
            el.innerText = `Player ${num}\n(Taken)`;
          } else {
            el.innerText = `Player ${num}`;
          }
        });
        if (chosenPlayer) {
          document.querySelector(`.player[data-num="${chosenPlayer}"]`).classList.add('chosen');
        }
      } else if (msg.type === 'chosen') {
        chosenPlayer = msg.playerNum;
        status.innerText = `You are Player ${chosenPlayer}`;
      } else if (msg.type === 'error') {
        alert(msg.message);
      }
    };

    document.querySelectorAll('.player').forEach(el => {
      el.addEventListener('click', () => {
        const num = el.dataset.num;
        if (!el.classList.contains('taken') && !chosenPlayer) {
          ws.send(JSON.stringify({ type: 'choose', playerNum: num }));
        }
      });
    });
  </script>
</body>
</html>
